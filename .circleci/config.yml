# Use the latest 2.1 version of CircleCI pipeline process engine. See: https://circleci.com/docs/2.0/configuration-reference
version: 2.1
# Use a package of configuration called an orb.
orbs:
  # Declare a dependency on the welcome-orb
  welcome: circleci/welcome-orb@0.4.1
# Orchestrate or schedule a set of jobs
workflows:
  # Name the workflow "welcome"
  welcome:
    # Run the welcome/run job in its own container
    jobs:
      build:
        docker:
          - image: circleci/php:7.4.3
          - image: circleci/mysql:8.0.3
            environment:
              MYSQL_DATABASE: quizGame
              MYSQL_ROOT: root

        steps:
            - run: sudo apt update
            - run: sudo wget https://get.symfony.com/cli/installer -O - | bash

            - run:
                command: php bin/console cache:clear --env=prod
                working_directory: ./
            - run:
                command: composer install
                working_directory: ./
            - run:
                command: php bin/console doctrine:database:create
                working_directory: ./
            - run:
                command: yes | php app/console doctrine:fixtures:load --fixtures=src/DataFixtures/Dev || true
                working_directory: ./
            - run:
                command: symfony serve -d
                working_directory: ./
            - run:
                command: php bin/phpunit
                working_directory: ./
            - run:
                command: symfony server:stop
                working_directory: ./
